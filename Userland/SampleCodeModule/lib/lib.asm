GLOBAL get_date_time
GLOBAL screen_clear
GLOBAL change_color
GLOBAL zoom
GLOBAL get_regist
GLOBAL make_sound
; TODO: Hacer que todas las syscalls usen EXPORT_FUNC

%macro pushStateNoRAX 0
    push rbx
    push rcx
    push rdx
    push rbp
    push rdi
    push rsi
    push r8
    push r9
    push r10
    push r11
    push r12
    push r13
    push r14
    push r15
%endmacro

%macro popStateNoRAX 0
    pop r15
    pop r14
    pop r13
    pop r12
    pop r11
    pop r10
    pop r9
    pop r8
    pop rsi
    pop rdi
    pop rbp
    pop rdx
    pop rcx
    pop rbx
%endmacro

%macro pushState 0
    push rax
    pushStateNoRAX
%endmacro

%macro popState 0
    popStateNoRAX
    pop rax
%endmacro

%macro do_syscall_direct 1
    pushStateNoRAX
		mov rax, %1
    int 80h
    popStateNoRAX
    ret
%endmacro

%macro do_syscall 4
    pushStateNoRAX
    mov rax, %1
    mov rdx, %2
    mov rsi, %3
    mov rdi, %4
    int 80h
    popStateNoRAX
    ret
%endmacro

%macro EXPORT_FUNC 1
    GLOBAL _%1
    _%1:
%endmacro

;-------------------------------------------------------------------------------
; Funcion : read
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - fd
;   2 - buffer
;   3 - count
;-------------------------------------------------------------------------------
EXPORT_FUNC read
    do_syscall_direct 0x00

;-------------------------------------------------------------------------------
; Funcion : write
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - fd
;   2 - buffer
;   3 - count
;-------------------------------------------------------------------------------
EXPORT_FUNC write
	do_syscall_direct 0x01

;-------------------------------------------------------------------------------
; 0x02 - screen_clear
;-------------------------------------------------------------------------------
EXPORT_FUNC screen_clear
    do_syscall 0x02, 0, 0, 0

;-------------------------------------------------------------------------------
; 0x03 - change_color
;-------------------------------------------------------------------------------
EXPORT_FUNC change_color
    do_syscall 0x03, 0, 0, rdi

;-------------------------------------------------------------------------------
; 0x04 - get_date_time
;-------------------------------------------------------------------------------
EXPORT_FUNC get_date_time
    do_syscall 0x04, 0, 0, 0

;-------------------------------------------------------------------------------
; 0x05 - sleep_time
;-------------------------------------------------------------------------------
EXPORT_FUNC sleep_time
    do_syscall_direct 0x05

;-------------------------------------------------------------------------------
; 0x06 - zoom
;-------------------------------------------------------------------------------
EXPORT_FUNC zoom
    do_syscall 0x06, 0, 0, rdi

;-------------------------------------------------------------------------------
; 0x07 - get_regist
;-------------------------------------------------------------------------------
EXPORT_FUNC get_regist
    do_syscall 0x07, 0, 0, rdi

;-------------------------------------------------------------------------------
; 0x08 - make_sound
;-------------------------------------------------------------------------------
;make_sound:
;    do_syscall 0x08, rsi, 0, rdi

;-------------------------------------------------------------------------------
; 0x09 - read_kmsg
;-------------------------------------------------------------------------------
EXPORT_FUNC read_kmsg
    do_syscall 0x09, 0, rsi, rdi

;-------------------------------------------------------------------------------
; 0x0A - pipe_create
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - id
;-------------------------------------------------------------------------------
EXPORT_FUNC pipe_create
    do_syscall_direct 0x0A

;-------------------------------------------------------------------------------
; 0x0B - pipe_open
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - id
;   2 - mode
;-------------------------------------------------------------------------------
EXPORT_FUNC pipe_open
    do_syscall_direct 0x0B

;-------------------------------------------------------------------------------
; 0x0C - pipe_close
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - id
;-------------------------------------------------------------------------------
EXPORT_FUNC pipe_close
    do_syscall_direct 0x0C

;-------------------------------------------------------------------------------
; 0x0D - get_procs
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - buffer
;   2 - count
;-------------------------------------------------------------------------------
EXPORT_FUNC get_procs
    do_syscall_direct 0x0D

;-------------------------------------------------------------------------------
; 0x0E - load_program
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - name
;   2 - entry point
;-------------------------------------------------------------------------------
EXPORT_FUNC load_program
    do_syscall_direct 0x0E

;-------------------------------------------------------------------------------
; 0x0F - rm_program
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - name
;-------------------------------------------------------------------------------
EXPORT_FUNC rm_program
    do_syscall_direct 0x0F

;-------------------------------------------------------------------------------
; 0x10 - get_programs
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - buffer
;   2 - count
;-------------------------------------------------------------------------------
EXPORT_FUNC get_programs
    do_syscall_direct 0x10

;-------------------------------------------------------------------------------
; 0x11 - spawn_process
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - name
;   2 - argc
;   3 - argv
;   4 - fds
;   5 - background
;-------------------------------------------------------------------------------
EXPORT_FUNC spawn_process
    do_syscall_direct 0x11

;-------------------------------------------------------------------------------
; 0x12 - kill_proc
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - pid
;-------------------------------------------------------------------------------
EXPORT_FUNC kill_proc
    do_syscall_direct 0x12

;-------------------------------------------------------------------------------
; 0x13 - change_priority
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - pid
;   2 - new_priority
;-------------------------------------------------------------------------------
EXPORT_FUNC change_priority
    do_syscall_direct 0x13

;-------------------------------------------------------------------------------
; 0x14 - proc_exit
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - exit code
;-------------------------------------------------------------------------------
EXPORT_FUNC proc_exit
    do_syscall_direct 0x14

;-------------------------------------------------------------------------------
; 0x15 - block_proc
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - id
;-------------------------------------------------------------------------------
EXPORT_FUNC block_proc
    do_syscall_direct 0x15

;-------------------------------------------------------------------------------
; 0x16 - unblock_proc
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - id
;-------------------------------------------------------------------------------
EXPORT_FUNC unblock_proc
    do_syscall_direct 0x16

;-------------------------------------------------------------------------------
; 0x17 - copy_fd
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - pid
;   2 - target_fd
;   3 - source_fd
;-------------------------------------------------------------------------------
EXPORT_FUNC copy_fd
    do_syscall_direct 0x17

;-------------------------------------------------------------------------------
; 0x18 - close_fd
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - fd
;-------------------------------------------------------------------------------
EXPORT_FUNC close_fd
    do_syscall_direct 0x18

;-------------------------------------------------------------------------------
; 0x19 - wait_pid
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - pid
;   2 - status
;-------------------------------------------------------------------------------
EXPORT_FUNC wait_pid
    do_syscall_direct 0x19

;-------------------------------------------------------------------------------
; 0x1A - wait
;-------------------------------------------------------------------------------
; Argumentos:
;   1 - status
;-------------------------------------------------------------------------------
EXPORT_FUNC wait
    do_syscall_direct 0x1A

;-------------------------------------------------------------------------------
; 0x1B - get_pid
;-------------------------------------------------------------------------------
EXPORT_FUNC get_pid
    do_syscall_direct 0x1B

